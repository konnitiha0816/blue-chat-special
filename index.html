<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Chat Special</title>
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®šï¼ˆæ¼†é»’ãƒ†ãƒ¼ãƒï¼‰ --- */
        :root {
            --bg-color: #000000;
            --panel-bg: #111111;
            --text-color: #ffffff;
            --accent-blue: #007bff;
            --accent-red: #ff4444;
            --sidebar-height: 70px;
        }

        body, html { margin: 0; padding: 0; background: var(--bg-color); color: var(--text-color); font-family: sans-serif; height: 100vh; overflow: hidden; }

        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* UIãƒ‘ãƒ¼ãƒ„å…±é€š */
        .logo { position: fixed; top: 20px; left: 20px; font-size: 22px; font-weight: bold; letter-spacing: 1px; z-index: 1000; text-shadow: 0 0 10px #007bff; }
        .role-badge { position: fixed; top: 20px; right: 20px; font-size: 12px; color: #aaa; border: 1px solid #444; padding: 5px 10px; border-radius: 4px; z-index: 1000; }
        
        .box { background: var(--panel-bg); padding: 40px; border-radius: 12px; border: 1px solid #333; text-align: center; width: 90%; max-width: 450px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        
        input { width: 100%; padding: 12px; margin: 15px 0; background: #222; border: 1px solid #444; color: white; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        
        button { padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px; width: 100%; font-size: 16px; transition: 0.3s; }
        .btn-blue { background: var(--accent-blue); color: white; }
        .btn-blue:hover { filter: brightness(1.2); }
        .btn-red { background: var(--accent-red); color: white; }

        /* 0. ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        #screen-title { background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%); }
        .title-logo { font-size: 50px; font-weight: bold; margin-bottom: 30px; text-shadow: 0 0 25px var(--accent-blue); }

        /* 4. æº–å‚™ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .prep-container { display: flex; gap: 20px; width: 85%; max-width: 900px; height: 500px; background: #0a0a0a; padding: 25px; border-radius: 15px; border: 1px solid #333; }
        .prep-video { flex: 1.5; background: #000; border: 1px solid #333; display: flex; align-items: center; justify-content: center; position: relative; }
        .prep-ui { flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 20px; }
        .toggle-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-size: 18px; }

        /* 6. ãƒ¡ã‚¤ãƒ³é€šè©±ç”»é¢ */
        #main-area { width: 100%; height: calc(100vh - var(--sidebar-height)); margin-top: 60px; display: flex; position: relative; }
        #video-grid { flex: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; padding: 10px; overflow-y: auto; }
        .video-card { background: #111; border: 1px solid #333; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; min-height: 200px; }
        
        /* ç”»é¢å…±æœ‰ã‚¨ãƒªã‚¢ */
        #share-area { display: none; width: 45%; background: #050505; border-left: 2px solid #333; align-items: center; justify-content: center; flex-direction: column; }
        
        /* ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ */
        #chat-sidebar { display: none; width: 350px; background: #0e0e0e; border-left: 1px solid #333; flex-direction: column; position: absolute; right: 0; top: 0; bottom: 0; z-index: 500; box-shadow: -5px 0 20px rgba(0,0,0,0.5); }
        #chat-log { flex: 1; overflow-y: auto; padding: 15px; }
        .msg { margin-bottom: 10px; padding: 8px 12px; background: #1f1f1f; border-radius: 8px; font-size: 14px; word-break: break-all; }
        .msg strong { color: var(--accent-blue); display: block; margin-bottom: 4px; font-size: 12px; }

        /* ãƒœãƒˆãƒ ãƒãƒ¼ */
        .bottom-bar { position: fixed; bottom: 0; width: 100%; height: var(--sidebar-height); background: rgba(10,10,10,0.95); border-top: 1px solid #333; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 2000; }
        .icon-btn { width: 50px; height: 50px; border-radius: 50%; background: transparent; color: white; border: none; font-size: 22px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .icon-btn:hover { background: rgba(255,255,255,0.1); transform: scale(1.1); }
        .icon-btn.red { background: var(--accent-red); }

        /* ç”³è«‹ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #modal-req { display: none; position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: #222; padding: 30px; border: 1px solid var(--accent-blue); border-radius: 10px; z-index: 3000; text-align: center; box-shadow: 0 0 30px rgba(0,123,255,0.4); width: 300px; }
    </style>
</head>
<body>
    <div class="logo">Blue Chat Special</div>
    <div id="role-display" class="role-badge" style="display:none;"></div>

    <div id="screen-title" class="screen active">
        <div class="title-logo">Blue Chat Special</div>
        <p style="color:#888; margin-bottom: 40px;">Professional Video Communication</p>
        <button class="btn-blue" style="width:200px; padding:15px; border-radius:30px; font-size:20px;" onclick="switchScreen('screen-quiz')">START</button>
    </div>

    <div id="screen-quiz" class="screen">
        <div class="box">
            <h2>Security Check</h2>
            <p style="font-size:24px; margin:20px;">7 Ã— 8 = ?</p>
            <input type="number" id="quiz-ans" placeholder="ç­”ãˆã‚’å…¥åŠ›">
            <button class="btn-blue" onclick="checkQuiz()">èªè¨¼ã™ã‚‹</button>
        </div>
    </div>

    <div id="screen-mode" class="screen">
        <div class="box">
            <h2>Select Mode</h2>
            <button class="btn-blue" onclick="setMode('create')">ğŸ†• é€šè©±ã‚’æ–°ã—ãä½œã‚‹</button>
            <button class="btn-blue" style="background:#333; margin-top:15px;" onclick="setMode('join')">ğŸ‘¥ é€²è¡Œä¸­ã®é€šè©±ã«å‚åŠ </button>
        </div>
    </div>

    <div id="screen-id" class="screen">
        <div class="box">
            <h2 id="id-title">IDè¨­å®š</h2>
            <input type="text" id="id-input" placeholder="ID (3æ–‡å­—ä»¥ä¸Š)">
            <p id="id-err" style="color:var(--accent-red); font-size:13px;"></p>
            <button class="btn-blue" onclick="submitId()">æ¬¡ã¸</button>
        </div>
    </div>

    <div id="screen-prep" class="screen">
        <div class="prep-container">
            <div class="prep-video">
                <div style="text-align:center; color:#555;">
                    <div style="font-size:50px;">ğŸ“·</div>
                    <p>Camera Preview</p>
                </div>
            </div>
            <div class="prep-ui">
                <h3 style="margin-top:0;">Setup</h3>
                <div class="toggle-item">
                    <span>Camera</span>
                    <button id="btn-cam" class="btn-blue" style="width:70px; margin:0;" onclick="togglePrep('cam')">ON</button>
                </div>
                <div class="toggle-item">
                    <span>Microphone</span>
                    <button id="btn-mic" class="btn-blue" style="width:70px; margin:0;" onclick="togglePrep('mic')">ON</button>
                </div>
                <input type="text" id="nick-input" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›" style="margin-top:30px;">
                <button id="btn-go-main" class="btn-blue" style="margin-top:auto;" onclick="enterRoom()">é–‹å§‹ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <div id="screen-wait" class="screen">
        <div class="box">
            <h2>Requesting...</h2>
            <p>ä¸»å‚¬è€…ã®æ‰¿èªã‚’å¾…ã£ã¦ã„ã¾ã™</p>
            <div style="font-size:40px; margin-top:20px; animation:spin 2s linear infinite;">â³</div>
        </div>
    </div>

    <div id="screen-main" class="screen">
        <div id="main-area">
            <div id="video-grid">
                <div class="video-card" style="height:100%;">
                    <div style="font-size:50px; margin-bottom:10px;">ğŸ‘¤</div>
                    <span id="my-label" style="background:rgba(0,0,0,0.5); padding:2px 8px; border-radius:4px;">è‡ªåˆ†</span>
                </div>
            </div>
            
            <div id="share-area">
                <div style="text-align:center;">
                    <div style="font-size:60px; color:var(--accent-blue); margin-bottom:10px;">ğŸ–¥ï¸</div>
                    <p style="font-size:18px;">Screen Sharing Active</p>
                </div>
            </div>

            <div id="chat-sidebar">
                <div style="padding:15px; border-bottom:1px solid #333; font-weight:bold;">Chat Room</div>
                <div id="chat-log"></div>
                <div style="padding:15px; border-top:1px solid #333; display:flex;">
                    <input type="text" id="msg-input" placeholder="Message..." style="margin:0; flex:1;">
                    <button class="btn-blue" style="width:50px; margin-left:10px; margin-top:0;" onclick="sendMsg()">â¤</button>
                </div>
            </div>
        </div>

        <div class="bottom-bar">
            <div style="width:200px;">
                <div id="clock" style="font-family:monospace; font-size:20px;">00:00:00</div>
                <div style="font-size:12px; color:#888;">ID: <span id="disp-id">---</span></div>
            </div>
            
            <div style="display:flex; gap:15px;">
                <button class="icon-btn" onclick="alert('Mute/Unmute')">ğŸ¤</button>
                <button class="icon-btn" onclick="alert('Camera On/Off')">ğŸ“·</button>
                <button class="icon-btn" onclick="toggleShare()" title="ç”»é¢å…±æœ‰">ğŸ–¥ï¸</button>
                <button class="icon-btn" onclick="toggleChat()" title="ãƒãƒ£ãƒƒãƒˆ">ğŸ’¬</button>
                <button class="icon-btn red" onclick="location.reload()" title="åˆ‡æ–­">âŒ</button>
            </div>
            
            <div style="width:200px; text-align:right;">
                <button class="icon-btn" style="margin-left:auto;" onclick="alert('Participants: 2')">ğŸ‘¥</button>
            </div>
        </div>
    </div>

    <div id="modal-req">
        <h3 style="margin-top:0;">å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h3>
        <p><strong id="req-user" style="color:var(--accent-blue);">Guest User</strong> ã•ã‚“ãŒ<br>å‚åŠ ã‚’å¸Œæœ›ã—ã¦ã„ã¾ã™ã€‚</p>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn-blue" onclick="approve()">æ‰¿èªã™ã‚‹</button>
            <button class="btn-red" onclick="document.getElementById('modal-req').style.display='none'">æ‹’å¦</button>
        </div>
    </div>

    <audio id="snd-msg" src="message.mp3"></audio>
    <audio id="snd-req" src="request.mp3"></audio>

    <script>
        // --- çŠ¶æ…‹å¤‰æ•° ---
        let role = '';
        let nickname = '';
        let roomId = '';
        let activeIds = ['test01', 'demo99']; // æ—¢å­˜IDã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        let isShare = false;
        let isChat = false;

        // --- ç”»é¢é·ç§»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- æ™‚è¨ˆæ©Ÿèƒ½ ---
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('ja-JP', {hour12:false});
        }, 1000);

        // --- 1. èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ ---
        function checkQuiz() {
            const ans = document.getElementById('quiz-ans').value;
            if(ans == '56') {
                switchScreen('screen-mode');
            } else {
                alert('èªè¨¼å¤±æ•—ï¼šç­”ãˆãŒé•ã„ã¾ã™ã€‚');
            }
        }

        // --- 2. ãƒ¢ãƒ¼ãƒ‰è¨­å®š ---
        function setMode(m) {
            role = (m === 'create') ? 'Host' : 'Guest';
            document.getElementById('id-title').innerText = (role === 'Host') ? 'IDã‚’ä½œæˆ' : 'IDã‚’å…¥åŠ›';
            switchScreen('screen-id');
        }

        // --- 3. IDãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ---
        function submitId() {
            const val = document.getElementById('id-input').value;
            const err = document.getElementById('id-err');
            
            if(val.length < 3) {
                err.innerText = 'IDã¯3æ–‡å­—ä»¥ä¸Šå¿…è¦ã§ã™'; return;
            }
            if(role === 'Host' && activeIds.includes(val)) {
                err.innerText = 'ã“ã®IDã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™'; return;
            }

            roomId = val;
            document.getElementById('disp-id').innerText = roomId;
            document.getElementById('btn-go-main').innerText = (role === 'Host') ? 'é€šè©±ãƒ«ãƒ¼ãƒ ã‚’ä½œã‚‹' : 'å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹';
            switchScreen('screen-prep');
        }

        // --- 4. æº–å‚™ç”»é¢ãƒˆã‚°ãƒ« ---
        function togglePrep(type) {
            const btn = document.getElementById(type === 'cam' ? 'btn-cam' : 'btn-mic');
            const isOn = btn.innerText === 'ON';
            btn.innerText = isOn ? 'OFF' : 'ON';
            btn.style.background = isOn ? '#444' : 'var(--accent-blue)';
        }

        function enterRoom() {
            nickname = document.getElementById('nick-input').value || 'No Name';
            document.getElementById('my-label').innerText = nickname + ' (ã‚ãªãŸ)';
            
            const badge = document.getElementById('role-display');
            badge.style.display = 'block';
            badge.innerText = (role === 'Host') ? 'ğŸ‘‘ ä¸»å‚¬è€…' : 'ğŸ‘¤ å‚åŠ è€…';

            if(role === 'Host') {
                switchScreen('screen-main');
                // ã€ãƒ‡ãƒ¢ã€‘10ç§’å¾Œã«ã‚²ã‚¹ãƒˆã‹ã‚‰ã®ç”³è«‹ãŒæ¥ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                setTimeout(() => {
                    document.getElementById('modal-req').style.display = 'block';
                    try { document.getElementById('snd-req').play(); } catch(e){}
                }, 8000);
            } else {
                switchScreen('screen-wait');
                // ã€ãƒ‡ãƒ¢ã€‘3ç§’å¾Œã«æ‰¿èªã•ã‚Œã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                setTimeout(() => {
                    alert('ä¸»å‚¬è€…ã«æ‰¿èªã•ã‚Œã¾ã—ãŸï¼');
                    switchScreen('screen-main');
                }, 3000);
            }
        }

        // --- 5. ãƒ¡ã‚¤ãƒ³ç”»é¢æ©Ÿèƒ½ ---
        
        // æ‰¿èªå‡¦ç† (ä¸»å‚¬è€…ã®ã¿)
        function approve() {
            document.getElementById('modal-req').style.display = 'none';
            // å‚åŠ è€…ãƒ“ãƒ‡ã‚ªã‚’è¿½åŠ 
            const grid = document.getElementById('video-grid');
            const card = document.createElement('div');
            card.className = 'video-card';
            card.innerHTML = '<div style="font-size:50px; margin-bottom:10px;">ğŸ‘¤</div><span>Guest User</span>';
            grid.appendChild(card);
        }

        // ç”»é¢å…±æœ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleShare() {
            isShare = !isShare;
            const shareArea = document.getElementById('share-area');
            shareArea.style.display = isShare ? 'flex' : 'none';
        }

        // ãƒãƒ£ãƒƒãƒˆè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleChat() {
            isChat = !isChat;
            document.getElementById('chat-sidebar').style.display = isChat ? 'flex' : 'none';
        }

        // ãƒãƒ£ãƒƒãƒˆé€ä¿¡
        function sendMsg() {
            const input = document.getElementById('msg-input');
            const text = input.value;
            if(!text) return;

            const log = document.getElementById('chat-log');
            const item = document.createElement('div');
            item.className = 'msg';
            item.innerHTML = `<strong>${nickname}</strong>${text}`;
            log.appendChild(item);
            
            input.value = '';
            
            // éŸ³ã‚’é³´ã‚‰ã™
            try { document.getElementById('snd-msg').play(); } catch(e){}
        }
    </script>
</body>
</html>
